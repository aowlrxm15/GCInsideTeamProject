<?xml version="1.0" encoding="UTF-8"?>
<!-- 2023/03/16 // 김동민 // 마이너 xml 생성 -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.gcInside.dao.MinorDAO">
    <!-- insert -->
    <!-- 2023/03/16 // 김동민 // 마이너 갤러리 생성(uid 바꿔야함) -->
    <insert id="creategall" parameterType="kr.co.gcInside.vo.CreateVO">
        INSERT INTO `gc_admin_gell_create_approve` SET
        `gell_create_rdate`   = NOW(),
        `gell_create_status`  = '0',
        `gell_create_uid`     = 'qwe123',
        `gell_create_name`    = #{gell_create_name},
        `gell_create_intro`   = #{gell_create_intro},
        `gell_create_cate`    = #{gell_cate2},
        `gell_create_address` = #{gell_create_address},
        `gell_create_reason`  = #{gell_create_reason};
    </insert>
    
    <!-- select -->
    <!-- 2023/03/16 // 김동민 // 마이너 갤러리 생성시 카테고리 선택 -->
    <select id="selectcate2" resultType="kr.co.gcInside.vo.CreateVO">
        SELECT * from `gc_gell_cate2`;
    </select>
    <!-- 2023/03/16 // 김동민 // 마이너 갤러리 생성약관 -->
    <select id="selectminorterms" resultType="kr.co.gcInside.vo.TermsVO">
        SELECT * FROM `gc_terms`;
    </select>
    <!-- 2023/03/21 // 김동민 // validation -->
    <select id="countBygellname" resultType="int" parameterType="String">
        select count(*) from `gc_gell` where gell_name = #{gell_create_name};
    </select>
    <!-- 2023/03/22 // 김동민 // validation -->
    <select id="countBygelladdress" resultType="int" parameterType="String">
        select count(*) from `gc_gell` where gell_address = #{gell_create_address};
    </select>
    <!-- 2023/03/23 // 김동민 // 마이너 갤러리 index 흥한 갤러리 select -->
    <select id="selecthotmgallranking" resultType="kr.co.gcInside.vo.gell_articleVO">
        SELECT `articlel_gell_num`, COUNT(*)
        FROM `gc_gell_article`
        WHERE DATE(article_rdate) = CURDATE()
        GROUP BY `articlel_gell_num`
        ORDER BY COUNT(*) DESC;

    </select>
    <!--오늘 생성된 글의 갯수가 높은순으로 갤러리명만 출력 -->
    <!--SELECT articlel_gell_num
    FROM (
    SELECT articlel_gell_num, COUNT(*) as cnt
    FROM `gc_gell_article`
    WHERE DATE(article_rdate) = CURDATE()
    GROUP BY articlel_gell_num
    ) AS subquery
    ORDER BY cnt DESC;
    -->
    <!--갤러리명만 출력한것을 gc_gell테이블 gell_num에 일치하는게 있다면 출력하는 쿼리 -->
    <select id="selecthotmgall" resultType="kr.co.gcInside.vo.galleryVO">
    SELECT *
    FROM `gc_gell` WHERE `gell_num` IN (
    SELECT articlel_gell_num
    FROM (
    SELECT articlel_gell_num, COUNT(*) as cnt
    FROM `gc_gell_article`
    WHERE DATE(article_rdate) = CURDATE()
    GROUP BY articlel_gell_num
    ) AS subquery
    ORDER BY cnt DESC)
    ;
    </select>

</mapper>